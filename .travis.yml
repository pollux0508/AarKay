language: objective-c
osx_image: xcode10.2
branches:
  only:
    - master
    - develop
    - ci
    - /^v\d+\.\d+(\.\d+)?(-\S*)?$/

env:
  global:
    - LC_CTYPE=en_US.UTF-8
    - LANG=en_US.UTF-8

jobs:
  include:
    - stage: Tests
      name: Unit Tests
      script: make test
    - name: Integration Tests
      before_install:
        - brew update
        - brew install rename cookiecutter
      script:
        - |
          echo version: \'.revision\(\"$TRAVIS_COMMIT\"\)\' > $TRAVIS_BUILD_DIR/AarKay/AarKayData/NoPlugin/aarkay-plugin-pluginlowername/Package.yml
        - |
          echo version: \'r-$TRAVIS_COMMIT\' > $TRAVIS_BUILD_DIR/AarKay/AarKayData/NoPlugin/Sources/AarKayRunnerKit/RunnerFiles/AarKayDependency.Runner.yml
        - git commit -am "Update Plugin Package.swift"
        - sh scripts/run
        - sh scripts/template
        - cd AarKay && cookiecutter --no-input $TRAVIS_BUILD_DIR name=test && cd ..
        - make build
        - echo "./../../AarKay, r-$TRAVIS_COMMIT" > AarKay/AarKayFile
        - .build/release/AarKayRunner init
        - echo "https://github.com/rahulkatariya/aarkay-plugin-personal.git, b-master" >> AarKay/AarKayFile
        - echo "./aarkay-plugin-test, b-master" >> AarKay/AarKayFile
        - .build/release/AarKayRunner install
        - .build/release/AarKayRunner --verbose --force --exitOnError
        - .build/release/AarKayRunner init --global
        - echo "https://github.com/RahulKatariya/AarKay.git, r-$TRAVIS_COMMIT" > $HOME/AarKay/AarKayFile
        - .build/release/AarKayRunner update --global
        - cd aarkay-plugin-pluginlowername && ../.build/release/AarKayRunner -vfge
        - sh scripts/run
